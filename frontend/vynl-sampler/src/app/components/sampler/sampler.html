<!-- src/app/components/sampler/sampler.html -->

<div class="min-h-screen text-vynl-carbon relative overflow-hidden">

  <!-- Background image -->
  <div class="fixed inset-0 z-0">
    <img
      src="https://images.unsplash.com/photo-1687627671714-86d03b4e15ab?q=80&w=1470&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
      alt="Fondo dramÃ¡tico de nubes" class="w-full h-full object-cover">
    <!-- Overlay para glass effect -->
    <div class="absolute inset-0 bg-white/5 backdrop-blur-[0.5px]"></div>
  </div>

  <div class="relative z-10 p-4">
    
    <!-- ðŸŽšï¸ Header Principal - MÃ¡s Compacto -->
    <div class="glass backdrop-blur-xl border border-white/20 rounded-2xl p-4 mb-4">
      <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4">
        
        <!-- ðŸŽµ Logo y Tagline -->
        <div class="flex flex-col sm:flex-row sm:items-center gap-3">
          <div class="flex flex-col items-start">
            <h1 class="text-2xl sm:text-3xl font-bold text-vynl-black font-mono tracking-wider leading-none">
              VYNL
            </h1>
            <span class="text-vynl-white text-xs font-medium tracking-wide opacity-90 lg:hidden">
              Samplea lo Underground
            </span>
          </div>
          <span class="hidden lg:block text-vynl-white text-sm font-medium tracking-wide opacity-90 border-l border-vynl-slate/40 pl-4">
            Samplea lo Underground
          </span>
        </div>

        <!-- ðŸŽšï¸ Controles Principales -->
        <div class="flex items-center gap-4">
          <!-- BPM -->
          <div class="glass backdrop-blur-sm rounded-xl p-3 border border-white/30 text-center">
            <div class="text-vynl-charcoal text-xs font-medium mb-1">BPM</div>
            <div class="text-xl font-bold text-vynl-carbon">{{ bpm() }}</div>
          </div>

          <!-- Play/Stop -->
          <button (click)="togglePlay()" 
                  [class]="isPlaying() ? 'bg-vynl-carbon text-vynl-white' : 'bg-white/20 text-vynl-carbon'"
                  class="px-6 py-3 rounded-xl font-bold transition-all duration-100 backdrop-blur-sm border border-white/40">
            <span [innerHTML]="isPlaying() ? 'â¸' : 'â–¶'"></span>
            <span class="ml-2">{{ isPlaying() ? 'STOP' : 'PLAY' }}</span>
          </button>

          <!-- Toggle Sequencer -->
          <button (click)="toggleSequencer()"
                  class="px-4 py-3 bg-vynl-steel/60 text-vynl-carbon rounded-xl font-bold transition-all duration-100 border border-vynl-slate/40">
            {{ showSequencer() ? 'HIDE SEQ' : 'SHOW SEQ' }}
          </button>
        </div>
      </div>
    </div>

    <!-- ðŸŽ¹ Layout Principal Adaptativo -->
    <div class="space-y-4">
      
      <!-- ðŸŽµ Sequencer Section - Aparece arriba cuando estÃ¡ activo -->
      @if (showSequencer()) {
        <div class="sequencer-section">
          <app-sequencer></app-sequencer>
        </div>
      }

      <!-- ðŸŽ›ï¸ Sampler y Controles Layout -->
      <div class="grid grid-cols-1 xl:grid-cols-4 gap-4">

        <!-- ðŸŽ›ï¸ Pads del Sampler (3/4 del ancho en desktop) -->
        <div class="xl:col-span-3">
          <div class="glass backdrop-blur-xl border border-white/20 rounded-2xl p-4">
            <h2 class="text-vynl-silver text-lg font-bold mb-4 tracking-wide">PADS DEL SAMPLER</h2>

            <div class="grid grid-cols-4 gap-2">
              @for (pad of pads(); track pad.id) {
                <div class="relative group">
                  <button
                    (mousedown)="playPad(pad.id)"
                    (touchstart)="playPad(pad.id)"
                    (click)="selectPad(pad.id)"
                    class="w-full h-16 bg-white/10 backdrop-blur-sm border border-white/30 rounded-lg
                           hover:bg-white/20 active:bg-vynl-charcoal/10
                           transition-all duration-75 transform active:scale-95 relative overflow-hidden">

                    <!-- LED Indicator -->
                    <div class="absolute top-1 right-1 w-2 h-2 rounded-full border border-white/50"
                         [class]="pad.isActive ? 'bg-vynl-carbon animate-pulse-fast' : 'bg-vynl-slate/60'">
                    </div>

                    <!-- NÃºmero del Pad -->
                    <div class="absolute top-1 left-1 text-xs font-mono text-vynl-charcoal font-medium">
                      {{ pad.id + 1 }}
                    </div>

                    <!-- Pad Seleccionado -->
                    @if (selectedPad() === pad.id) {
                      <div class="absolute inset-0 border-2 border-vynl-carbon rounded-lg pointer-events-none"></div>
                    }

                    <!-- Nombre del Sample -->
                    <div class="flex items-end justify-center h-full pb-1">
                      <div class="text-xs font-medium text-vynl-carbon/90 truncate px-1 text-center">
                        {{ pad.sampleName }}
                      </div>
                    </div>
                  </button>
                </div>
              }
            </div>
          </div>
        </div>

        <!-- ðŸŽµ Panel de Controles (1/4 del ancho en desktop) -->
        <div class="xl:col-span-1">
          <div class="glass backdrop-blur-xl border border-white/20 rounded-2xl p-4 h-full">
            <h3 class="text-vynl-carbon text-lg font-bold mb-4 tracking-wide">
              {{ selectedPad() !== null ? 'PAD ' + (selectedPad()! + 1) : 'CONTROLES' }}
            </h3>

            <!-- ðŸ†• Waveform Compacto -->
            <div class="mb-4">
              <div class="bg-gradient-to-br from-vynl-carbon/10 to-vynl-carbon/30 
                          backdrop-blur-xl rounded-xl p-3 border border-vynl-slate/30">

                <div class="text-center text-vynl-white text-xs font-bold mb-2 opacity-90">
                  {{ selectedPad() !== null ? 'WAVEFORM' : 'SELECCIONA UN PAD' }}
                </div>

                <div class="relative w-full aspect-[4/1] bg-vynl-carbon/50 rounded-lg border border-vynl-graphite/40 overflow-hidden">
                  <canvas #waveformCanvas width="300" height="60" 
                          class="absolute inset-0 w-full h-full canvas-waveform">
                  </canvas>
                  <div class="absolute inset-0 bg-gradient-to-t from-vynl-carbon/20 to-transparent pointer-events-none"></div>
                </div>

                @if (selectedPad() !== null) {
                  <div class="mt-2 text-center">
                    <div class="text-xs text-vynl-slate/80 font-medium truncate">
                      {{ pads()[selectedPad()!].isLoaded ? pads()[selectedPad()!].sampleName : 'Arrastra archivo' }}
                    </div>
                  </div>
                }
              </div>
            </div>

            <!-- ðŸ†• Controles de Audio Compactos -->
            @if (selectedPad() !== null) {
              <div class="space-y-4">

                <!-- Control de Volumen -->
                <div>
                  <label class="block text-sm font-bold text-vynl-carbon mb-2">VOLUMEN</label>
                  <div class="flex items-center space-x-2">
                    <input type="range" [value]="currentPadVolume()" (input)="setPadVolume($event)" 
                           min="0" max="100" step="1"
                           class="flex-1 h-2 bg-vynl-slate/20 rounded-lg appearance-none cursor-pointer">
                    <div class="text-xs font-bold text-vynl-carbon min-w-[2.5rem] bg-vynl-cloud/80 px-2 py-1 rounded border border-vynl-steel">
                      {{ currentPadVolume() }}%
                    </div>
                  </div>
                </div>

                <!-- Control de Pitch -->
                <div>
                  <label class="block text-sm font-bold text-vynl-carbon mb-2">PITCH</label>
                  <div class="flex items-center space-x-2">
                    <input type="range" [value]="currentPadPitch()" (input)="setPadPitch($event)" 
                           min="-12" max="12" step="0.1"
                           class="flex-1 h-2 bg-vynl-slate/20 rounded-lg appearance-none cursor-pointer">
                    <div class="text-xs font-bold text-vynl-carbon min-w-[2.5rem] bg-vynl-cloud/80 px-2 py-1 rounded border border-vynl-steel">
                      {{ currentPadPitch() > 0 ? '+' : '' }}{{ currentPadPitch() }}
                    </div>
                  </div>
                </div>

                <!-- Efectos Compactos -->
                <div>
                  <label class="block text-sm font-bold text-vynl-carbon mb-2">EFECTOS</label>
                  <div class="grid grid-cols-3 gap-1">
                    <button (click)="toggleEffect('reverb')" 
                            [class]="hasEffect('reverb') ? 'bg-vynl-carbon text-vynl-white' : 'bg-vynl-silver/60 text-vynl-carbon'"
                            class="px-2 py-2 rounded-lg text-xs font-bold transition-all duration-75 border border-vynl-slate/30 transform active:scale-95">
                      REV
                    </button>
                    <button (click)="toggleEffect('delay')" 
                            [class]="hasEffect('delay') ? 'bg-vynl-carbon text-vynl-white' : 'bg-vynl-silver/60 text-vynl-carbon'"
                            class="px-2 py-2 rounded-lg text-xs font-bold transition-all duration-75 border border-vynl-slate/30 transform active:scale-95">
                      DEL
                    </button>
                    <button (click)="toggleEffect('filter')" 
                            [class]="hasEffect('filter') ? 'bg-vynl-carbon text-vynl-white' : 'bg-vynl-silver/60 text-vynl-carbon'"
                            class="px-2 py-2 rounded-lg text-xs font-bold transition-all duration-75 border border-vynl-slate/30 transform active:scale-95">
                      FLT
                    </button>
                  </div>
                </div>

                <!-- Acciones del Pad -->
                <div class="pt-3 border-t border-vynl-slate/30">
                  <div class="grid grid-cols-2 gap-2">
                    <button (click)="clearSelectedPad()"
                            class="bg-vynl-iron/40 text-vynl-white px-3 py-2 rounded-lg text-xs font-bold transition-all duration-75 border border-vynl-graphite/30 transform active:scale-95">
                      CLEAR
                    </button>
                    <button (click)="duplicatePad()"
                            class="bg-vynl-steel/40 text-vynl-carbon px-3 py-2 rounded-lg text-xs font-bold transition-all duration-75 border border-vynl-slate/40 transform active:scale-95">
                      COPY
                    </button>
                  </div>
                </div>

              </div>
            } @else {
              <!-- Mensaje cuando no hay pad seleccionado -->
              <div class="text-center text-vynl-charcoal text-sm mt-6 bg-vynl-cloud/20 p-4 rounded-lg border border-vynl-steel/30">
                <div class="text-vynl-carbon font-medium mb-1">PANEL DE CONTROLES</div>
                <div class="text-xs">Haz clic en un pad para controles</div>
              </div>
            }
          </div>
        </div>

      </div>

      <!-- ðŸŽšï¸ SecciÃ³n de Upload/Download - MÃ¡s Compacta -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        
        <!-- SecciÃ³n de Descarga -->
        <div class="glass backdrop-blur-xl border border-white/20 rounded-2xl p-4">
          <h3 class="text-vynl-carbon text-lg font-bold mb-3 tracking-wide">DESCARGAR AUDIO</h3>
          <div class="space-y-3">
            <input type="text" placeholder="URL de YouTube" 
                   class="w-full p-3 bg-white/60 backdrop-blur-sm border border-white/40 rounded-xl
                          text-vynl-carbon placeholder-vynl-charcoal/60 focus:border-vynl-carbon focus:outline-none transition-all duration-75">
            <button class="w-full bg-vynl-carbon text-vynl-white hover:bg-vynl-iron p-3 rounded-xl font-bold transition-all duration-75 transform active:scale-98">
              DESCARGAR Y SAMPLEAR
            </button>
          </div>
        </div>

        <!-- SecciÃ³n de Subida -->
        <div class="glass backdrop-blur-xl border border-white/20 rounded-2xl p-4">
          <h3 class="text-vynl-carbon text-lg font-bold mb-3 tracking-wide">SUBIR SAMPLES</h3>
          <div class="space-y-3">
            <input type="file" multiple accept="audio/*" (change)="onFileSelected($event)" 
                   class="w-full p-3 bg-white/60 backdrop-blur-sm border border-white/40 rounded-xl
                          text-vynl-carbon file:mr-3 file:py-1 file:px-3 file:rounded-lg
                          file:border-0 file:bg-vynl-carbon file:text-vynl-white file:font-medium">
            <div class="text-xs text-vynl-black font-medium">
              Sube tus drum packs (.wav, .mp3, .aiff)
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>